---
title: "Data Cleaning"
author: "Bri Baker"
date: "2/4/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(here)
library(lubridate)
library(janitor)
library(sf)
library(raster)
library(tmap)

```

```{r}
flowering_times <- read_csv(here("data/RSV_Flora_2020.csv")) %>%
  clean_names() %>% 
  dplyr::select(taxon, collecting, common_name, lifeform:dec) %>% 
  mutate(collecting = case_when(collecting == "X" ~ "yes",
                                TRUE ~ "no")) %>% 
  pivot_longer(cols = jan:dec, 
               values_drop_na = TRUE,
               names_to = "month") %>%
  filter(collecting == "yes") %>% 
  dplyr::select(taxon, common_name:month) %>%
  write_csv(here("data/flowering_times.csv"))


natives_vcla <- read_csv(here("data/vc_la_native_plants.csv")) %>%   clean_names() %>% 
  mutate(date = ymd(date)) %>% 
  write_csv(here("data/natives_vcla.csv"))


collection_locations <- read_csv(here("data/RSV_Collection Locations_2020_BB.csv"))
  
```
```{r}
protected_areas <- read_sf(here("data/Protected Areas.kml")) %>% 
  clean_names()

locations <- protected_areas %>% 
  dplyr::select(name) %>% 
  group_by(name) %>% 
  summarise()
  

#ggplot()+
  #geom_sf(data = collection_areas, aes(fill = name))


natives_location <- natives_vcla %>% 
  st_as_sf(coords = c("longitude","latitude")) %>% 
  st_set_crs(st_crs(protected_areas))

collection_areas <- locations %>% 
  filter(name %in% c("Arroyo Sequit",
                     "Cheeseboro/ Palo Comado Canyons",
                     "Circle X Ranch",
                     "Deer Creek",
                     "Diamond X Ranch",
                     "King Gillette Ranch",
                     "Paramount Ranch",
                     "Rancho Sierra Vista/Satwiwa",
                     "Rocky Oaks",
                     "Solstice Canyon",
                     "Upper Solstice Canyon",
                     "Yellowhill",
                     "Zuma/Trancas Canyons"
  ))# 

st_write(collection_areas, here("data","loc.gpkg"),format = "GPKG")


```


```{r}
species_desired <- unique(flowering_times$taxon)

natives_samo <- natives_location %>% 
  st_join(collection_areas, join = st_within) %>%
  filter(taxon %in% species_desired) %>% 
  dplyr::select(id, taxon, date, geometry)

st_write(natives_samo, here("data/desired_natives_samo.gpkg"), format = "GPKG")


```
```{r}
a_mill <- samo_plants %>% 
      filter(taxon == "Achillea millefolium") %>% 
  mutate(year = year(date))



ggplot(
      data = a_mill,
      aes(x = year)
)+
  geom_bar()
```



